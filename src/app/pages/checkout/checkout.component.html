<div class="checkout-container">

    <h2>Delivery Details</h2>

    <!-- SAVED ADDRESS -->
    <div *ngIf="user?.address; else noAddress" class="address-card shadow-2">
        <h4>{{ user?.displayName }}</h4>
        <p>{{ user?.address?.house }}, {{ user?.address?.area }}</p>
        <p>{{ user?.address?.city }} - {{ user?.address?.pincode }}</p>
        <p>Phone: {{ user?.phone }}</p>
        <p>Email: {{ user?.identifier }}</p>

        <button pButton label="Change Address" class="change-btn mt-2" (click)="openAddressDialog()"></button>
    </div>

    <!-- NO ADDRESS -->
    <ng-template #noAddress>
        <div class="empty-address-card" (click)="openAddressDialog()">
            <i class="pi pi-plus-circle"></i>
            <h4>Add Delivery Address</h4>
            <p>Tap to add a new address</p>
        </div>
    </ng-template>

    <!-- CHECKOUT BAR -->
    <div class="checkout-bar">
        <div class="row">
            <span>Total</span>
            <strong>â‚¹{{ total }}</strong>
        </div>

        <button pButton label="Proceed to Payment"
                class="pay-btn"
                (click)="goToPayment()"
                [disabled]="!user?.address">
        </button>
    </div>

</div>

<!-- ADDRESS FORM DIALOG -->
<p-dialog [(visible)]="addressPopup" [modal]="true" header="Add Delivery Address" [style]="{ width: '90%' }">

    <form [formGroup]="form" class="form">

        <input type="text" placeholder="Full Name" formControlName="name">

        <input type="email" placeholder="Email" formControlName="email" [readOnly]="true">

        <input type="text" placeholder="Phone Number" formControlName="phone">

        <input type="text" placeholder="House No, Street" formControlName="house">
        <input type="text" placeholder="Area / Landmark" formControlName="area">
        <input type="text" placeholder="City" formControlName="city">
        <input type="text" placeholder="Pincode" formControlName="pincode">
        <input type="text" placeholder="State" formControlName="state">

        <button pButton
                label="Save Address"
                class="save-btn mt-3"
                (click)="saveAddress()"
                [disabled]="form.invalid">
        </button>
    </form>

</p-dialog>
